<html><head><title>Core Apache Modules (Practical mod_perl)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Stas Bekman and Eric Cholet" /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="0-596-00227-0" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="Practical mod_perl" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">




<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="appb_16.html"><img src="../images//txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228" /><td align="right" valign="top" width="228"><a href="appb_18.html"><img src="../images//txtnexta.gif" alt="Next" border="0" /></a></td></tr></table></div>



<h2 class="sect1">B.17. Core Apache Modules</h2>

<a name="pmodperl-APP-B-SECT-17.1" /><div class="sect2">
<h3 class="sect2">B.17.1. Apache::Module&#8212;Interface to Apache C Module Structures</h3>

<p>This module provides <a name="pmodperl-APP-B-ITERM-6376" /><a name="pmodperl-APP-B-ITERM-6377" />an interface
<a name="pmodperl-APP-B-ITERM-6378" /><a name="pmodperl-APP-B-ITERM-6379" />to the list of Apache modules configured
with your <em class="emphasis">httpd</em> server and their <tt class="literal">module
*</tt>structures.</p>

<p>Available from CPAN. See the module manpage for more information.</p>

</div>
<a name="pmodperl-APP-B-SECT-17.2" /><div class="sect2">
<h3 class="sect2">B.17.2. Apache::ShowRequest&#8212;Show Phases and Module Participation</h3>

<p>Part of the <tt class="literal">Apache::Module</tt> package. This
module<a name="pmodperl-APP-B-ITERM-6380" /><a name="pmodperl-APP-B-ITERM-6381" /> allows you to see the all phases of the
request and what modules are participating in each of the phases.</p>

<p>Available from CPAN. See the module manpage for more information.</p>

</div>
<a name="pmodperl-APP-B-SECT-17.3" /><div class="sect2">
<h3 class="sect2">B.17.3. Apache::SubProcess&#8212;Interface to Apache Subprocess API</h3>

<p>The output of <tt class="literal">system( )</tt>, <tt class="literal">exec(
)</tt>, and <tt class="literal">open(PIPE,"|program")</tt> calls will
not be sent to the browser unless your Perl interpreter was
configured
<a name="pmodperl-APP-B-ITERM-6382" /><a name="pmodperl-APP-B-ITERM-6383" />with <tt class="literal">sfio</tt>.</p>

<p>One workaround is to use backticks:</p>

<blockquote><pre class="code">print `command here`;</pre></blockquote>

<p>But a cleaner solution is provided by the
<tt class="literal">Apache::SubProcess</tt> module. It overrides the
<tt class="literal">exec( )</tt> and <tt class="literal">system( )</tt> calls
with calls that work correctly under mod_perl.</p>

<p>Let's look at a few examples. This example overrides
the built-in <tt class="literal">system( )</tt> function and sends the
output to the browser:</p>

<blockquote><pre class="code">use Apache::SubProcess qw(system);
my $r = shift;
$r-&gt;send_http_header('text/plain');

system "/bin/echo hi there";</pre></blockquote>

<p>This example overrides the built-in <tt class="literal">exec( )</tt>
function and sends the output to the browser. As you can guess, the
<tt class="literal">print</tt>statement after the <tt class="literal">exec(
)</tt> call will never be executed.</p>

<blockquote><pre class="code">use Apache::SubProcess qw(exec);
my $r = shift;
$r-&gt;send_http_header('text/plain');

exec "/usr/bin/cal"; 

print "NOT REACHED\n";</pre></blockquote>

<p>The <tt class="literal">env( )</tt> function sets an environment variable
that can be seen by the main process and subprocesses, then it
executes the <em class="emphasis">/bin/env</em> program via
<tt class="literal">call_exec( )</tt>. The main code spawns a process, and
tells it to execute the <tt class="literal">env( )</tt> function. This call
returns an output file handle from the spawned child process.
Finally, it takes the output generated by the child process and sends
it to the browser via <tt class="literal">send_fd( )</tt>, which expects
the file handle as an argument:</p>

<blockquote><pre class="code">use Apache::SubProcess ( );
my $r = shift;
$r-&gt;send_http_header('text/plain');

my $efh = $r-&gt;spawn_child(\&amp;env);
$r-&gt;send_fd($efh);

sub env {
    my $fh = shift;
    $fh-&gt;subprocess_env(HELLO =&gt; 'world');
    $fh-&gt;filename("/bin/env");
    $fh-&gt;call_exec;
}</pre></blockquote>

<p>This example is very similar to the previous example, but it shows
how you can pass arguments to the external process. It passes the
string to print as a banner via a subprocess:</p>

<blockquote><pre class="code">use Apache::SubProcess ( );
my $r = shift;
$r-&gt;send_http_header('text/plain');

my $fh = $r-&gt;spawn_child(\&amp;banner);
$r-&gt;send_fd($fh);

sub banner {
    my $fh = shift;
    # /usr/games/banner on many Unices
    $fh-&gt;filename("/usr/bin/banner");
    $fh-&gt;args("-w40+Hello%20World");
    $fh-&gt;call_exec;
}</pre></blockquote>

<p>The last example shows how you can have full access to the
<tt class="literal">STDIN</tt>, <tt class="literal">STDOUT</tt>, and
<tt class="literal">STDERR</tt>streams of the spawned subprocess, so that
you can pipe data to a program and send its output to the browser:</p>

<blockquote><pre class="code">use Apache::SubProcess ( );
my $r = shift;
$r-&gt;send_http_header('text/plain');

use vars qw($string);
$string = "hello world";
my($out, $in, $err) = $r-&gt;spawn_child(\&amp;echo);
print $out $string;
$r-&gt;send_fd($in);

sub echo {
    my $fh = shift;
    $fh-&gt;subprocess_env(CONTENT_LENGTH =&gt; length $string);
    $fh-&gt;filename("/tmp/pecho");
    $fh-&gt;call_exec;
}</pre></blockquote>

<p>The <tt class="literal">echo( )</tt> function is similar to the earlier
example's <tt class="literal">env( )</tt> function.
<em class="emphasis">/tmp/pecho</em> is as follows:</p>

<blockquote><pre class="code">#!/usr/bin/perl 
read STDIN, $buf, $ENV{CONTENT_LENGTH}; 
print "STDIN: '$buf' ($ENV{CONTENT_LENGTH})\n";</pre></blockquote>

<p>In the last example, a string is defined as a global variable, so its
length could be calculated in the <tt class="literal">echo( )</tt>
function. The subprocess reads from <tt class="literal">STDIN</tt>, to
which the main process writes the string ("hello
world"). It reads only the number of bytes specified
by the <tt class="literal">CONTENT_LENGTH</tt> environment variable.
Finally, the external program prints the data that it read to
<tt class="literal">STDOUT</tt>, and the main program intercepts it and
sends it to the client's socket (i.e., to the
browser).</p>

<p>This module is also discussed in <a href="ch10_01.html">Chapter 10</a>.</p>

<p>Available from CPAN. See the module manpage for more information.</p>

</div>
<a name="pmodperl-APP-B-SECT-17.4" /><div class="sect2">
<h3 class="sect2">B.17.4. Apache::Connection&#8212;Interface to the Apache conn_rec Data Structure</h3>

<p>This module provides the Perl interface to
<a name="pmodperl-APP-B-ITERM-6384" /><a name="pmodperl-APP-B-ITERM-6385" />the <tt class="literal">conn_rec</tt> data
structure, which includes various records unique to each connection,
such as the state of a connection, server and base server records,
child number, etc. See <em class="emphasis">include/httpd.h</em> for a
complete description of this data structure.</p>

<p>Supplied with the mod_perl distribution. See the module manpage for
more information.</p>

</div>
<a name="pmodperl-APP-B-SECT-17.5" /><div class="sect2">
<h3 class="sect2">B.17.5. Apache::Constants&#8212;Constants Defined in httpd.h</h3>

<p>Server constants (<tt class="literal">OK</tt>, <tt class="literal">DENIED</tt>,
<tt class="literal">NOT_FOUND</tt>, etc.)
<a name="pmodperl-APP-B-ITERM-6386" /><a name="pmodperl-APP-B-ITERM-6387" />used by Apache modules are defined in
<em class="emphasis">httpd.h</em> and other header files. This module
gives Perl access to those constants.</p>

<p>Supplied with the mod_perl distribution. See the module manpage for
more information.</p>

</div>
<a name="pmodperl-APP-B-SECT-17.6" /><div class="sect2">
<h3 class="sect2">B.17.6. Apache::ExtUtils&#8212;Utilities for Apache C/Perl Glue</h3>

<p>Supplied with the mod_perl distribution. See the
<a name="pmodperl-APP-B-ITERM-6388" /><a name="pmodperl-APP-B-ITERM-6389" />module manpage for more information.</p>

</div>
<a name="pmodperl-APP-B-SECT-17.7" /><div class="sect2">
<h3 class="sect2">B.17.7. Apache::File&#8212;Advanced Functions for Manipulating Files on the Server Side</h3>

<p><tt class="literal">Apache::File</tt> does two things. First, it provides
an
<a name="pmodperl-APP-B-ITERM-6390" /><a name="pmodperl-APP-B-ITERM-6391" />object-oriented interface to file
handles, similar to Perl's standard
<tt class="literal">IO::File</tt> class. While the
<tt class="literal">Apache::File</tt> module does not provide all the
functionality of <tt class="literal">IO::File</tt>, its methods are
approximately twice as fast as the equivalent
<tt class="literal">IO::File</tt> methods. Secondly, when you use
<tt class="literal">Apache::File</tt>, it adds to the Apache class several
new methods that provide support for handling files under the
HTTP/1.1 protocol.</p>

<p>Supplied with the mod_perl distribution. See the module manpage for
more information.</p>

</div>
<a name="pmodperl-APP-B-SECT-17.8" /><div class="sect2">
<h3 class="sect2">B.17.8. Apache::Log&#8212;Interface to Apache Logging</h3>

<p>The <tt class="literal">Apache::Log</tt> module provides an
<a name="pmodperl-APP-B-ITERM-6392" /><a name="pmodperl-APP-B-ITERM-6393" />interface to Apache's
<tt class="literal">ap_log_error( )</tt> and <tt class="literal">ap_log_rerror(
)</tt> routines.</p>

<p>Supplied with the mod_perl distribution. See the module manpage for
more information.</p>

</div>
<a name="pmodperl-APP-B-SECT-17.9" /><div class="sect2">
<h3 class="sect2">B.17.9. Apache::LogFile&#8212;Interface to Apache's Logging Routines</h3>

<p>The <tt class="literal">PerlLogFile</tt> directive from this package
<a name="pmodperl-APP-B-ITERM-6394" /><a name="pmodperl-APP-B-ITERM-6395" />can be used to hook a Perl file handle to
a piped logger or to a file open for appending. If the first
character of the filename is a
"<tt class="literal">|</tt>", the file
handle is opened as a pipe to the given program. The file or program
can be relative to the <tt class="literal">ServerRoot</tt>.</p>

<p>So if <em class="emphasis">httpd.conf</em> contains these settings:</p>

<blockquote><pre class="code">PerlModule Apache::LogFile
PerlLogFile |perl/mylogger.pl My::Logger</pre></blockquote>

<p>in your code you can log to the <tt class="literal">My::Logger</tt> file
handle:</p>

<blockquote><pre class="code">print My::Logger "a message to the Log"</pre></blockquote>

<p>and it'll be piped through the
<em class="emphasis">perl/mylogger.pl</em> script.</p>

<p>Available from CPAN. See the module manpage for more information.</p>

</div>
<a name="pmodperl-APP-B-SECT-17.10" /><div class="sect2">
<h3 class="sect2">B.17.10. Apache::Scoreboard&#8212;Perl Interface to Apache's scoreboard.h</h3>

<p>Apache keeps track of server activity in a
<a name="pmodperl-APP-B-ITERM-6396" /><a name="pmodperl-APP-B-ITERM-6397" />structure known as the scoreboard. There
is a slot in the scoreboard for each child server, containing
information such as status, access count, bytes served, and CPU time.
This information is also used by mod_status to provide server
statistics in a human-readable form.</p>

<p>Available from CPAN. See the module manpage for more information.</p>

</div>
<a name="pmodperl-APP-B-SECT-17.11" /><div class="sect2">
<h3 class="sect2">B.17.11. Apache::Server&#8212;Perl Interface to the Apache server_rec Struct</h3>

<p>The <tt class="literal">Apache::Server</tt> class contains
<a name="pmodperl-APP-B-ITERM-6398" /><a name="pmodperl-APP-B-ITERM-6399" />information about the
server's configuration. Using this class
it's possible to retrieve any data set in
<em class="emphasis">httpd.conf</em> and <tt class="literal">&lt;Perl&gt;</tt>
sections.</p>

<p>Supplied with the mod_perl distribution. See the module manpage for
more information.</p>

</div>
<a name="pmodperl-APP-B-SECT-17.12" /><div class="sect2">
<h3 class="sect2">B.17.12. Apache::Table&#8212;Perl Interface to the Apache Table Struct</h3>

<p>This module provides tied interfaces
<a name="pmodperl-APP-B-ITERM-6400" /><a name="pmodperl-APP-B-ITERM-6401" />to Apache data structures. By using it
you can add, merge, and clear entries in
<em class="emphasis">headers_in</em>, <em class="emphasis">headers_out</em>,
<em class="emphasis">err_headers_out</em>, <em class="emphasis">notes</em>,
<em class="emphasis">dir_config</em>, and
<em class="emphasis">subprocess_env</em>.</p>

<p>Supplied with the mod_perl distribution. See the module manpage for
more information.</p>

</div>
<a name="pmodperl-APP-B-SECT-17.13" /><div class="sect2">
<h3 class="sect2">B.17.13. Apache::URI&#8212;URI Component Parsing and Unparsing</h3>

<p>This module provides an interface
<a name="pmodperl-APP-B-ITERM-6402" /><a name="pmodperl-APP-B-ITERM-6403" />to the Apache <tt class="literal">util_uri</tt>
module and the <tt class="literal">uri_components</tt>structure. The
available methods are: <tt class="literal">parsed_uri( )</tt>,
<tt class="literal">parse( )</tt>, <tt class="literal">unparse( )</tt>,
<tt class="literal">scheme( )</tt>, <tt class="literal">hostinfo( )</tt>,
<tt class="literal">user( )</tt>, <tt class="literal">password( )</tt>,
<tt class="literal">hostname( )</tt>, <tt class="literal">port( )</tt>,
<tt class="literal">path( )</tt>, <tt class="literal">rpath( )</tt>,
<tt class="literal">query( )</tt>, and <tt class="literal">fragment( )</tt>.</p>

<p>Supplied with the mod_perl distribution. See the module manpage for
more information.</p>

</div>
<a name="pmodperl-APP-B-SECT-17.14" /><div class="sect2">
<h3 class="sect2">B.17.14. Apache::Util&#8212;Perl Interface to Apache C Utility Functions</h3>

<p>This module provides a Perl interface
<a name="pmodperl-APP-B-ITERM-6404" /><a name="pmodperl-APP-B-ITERM-6405" />to some of the C utility functions
available in Apache. The same functionality is avaliable in
<em class="emphasis">libwww-perl</em>, but the C versions are faster:
<tt class="literal">escape_html( )</tt>, <tt class="literal">escape_uri( )</tt>,
<tt class="literal">unescape_uri( )</tt>, <tt class="literal">unescape_uri_info(
)</tt>, <tt class="literal">parsedate( )</tt>, <tt class="literal">ht_time(
)</tt>, <tt class="literal">size_string( )</tt>, and
<tt class="literal">validate_password( )</tt>.</p>

<p>Supplied with the mod_perl distribution. See <a name="pmodperl-APP-B-ITERM-6406" /><a name="pmodperl-APP-B-ITERM-6407" />the module manpage
for more information.</p>

</div>


<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="appb_16.html"><img src="../images//txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228"><a href="index.html"><img src="../images//txthome.gif" alt="Home" border="0" /></a></td><td align="right" valign="top" width="228"><a href="appb_18.html"><img src="../images//txtnexta.gif" alt="Next" border="0" /></a></td></tr><tr><td align="left" valign="top" width="228">B.16. Logging-Phase Handlers</td><td align="center" valign="top" width="228"><a href="index/index.html"><img src="../images//index.gif" alt="Book Index" border="0" /></a></td><td align="right" valign="top" width="228">B.18. Other Miscellaneous Modules</td></tr></table></div>
<hr width="684" align="left" />


<p><p><font size="-1"><a href="copyrght.html">Copyright &copy; 2003</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map">
<area shape="rect" coords="0,0,85,92" href="../index.html"><area shape="rect" coords="89,1,204,113" href="../apache/index.html"><area shape="rect" coords="208,-1,296,136" href="../php/index.html"><area shape="rect" coords="301,-1,403,132" href="../modperl/index.html"><area shape="rect" coords="406,3,503,115" href="../mysql/index.html"><area shape="rect" coords="507,2,596,142" href="../lian/index.html"><area shape="rect" coords="600,1,690,127" href="../rlinux/index.html">
</map>

</body></html>