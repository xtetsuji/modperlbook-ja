<html><head><title>Tracing System Calls (Practical mod_perl)</title><link rel="stylesheet" type="text/css" href="../style/style1.css" />

<meta name="DC.Creator" content="Stas Bekman and Eric Cholet" /><meta name="DC.Format" content="text/xml" scheme="MIME" /><meta name="DC.Language" content="en-US" /><meta name="DC.Publisher" content="O'Reilly &amp; Associates, Inc." /><meta name="DC.Source" scheme="ISBN" content="0-596-00227-0" /><meta name="DC.Subject.Keyword" content="stuff" /><meta name="DC.Title" content="Practical mod_perl" /><meta name="DC.Type" content="Text.Monograph" />

</head><body bgcolor="#ffffff">




<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch21_02.html"><img src="../images//txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228" /><td align="right" valign="top" width="228"><a href="ch21_04.html"><img src="../images//txtnexta.gif" alt="Next" border="0" /></a></td></tr></table></div>



<h2 class="sect1">21.3. Tracing System Calls</h2>

<p>Most <a name="pmodperl-CHP-21-ITERM-5515" /><a name="pmodperl-CHP-21-ITERM-5516" />Unix-style operating systems offer a
"tracing utility" that intercepts
and records the system calls that are called by a process and the
signals that are received by a process. In this respect it is similar
to <tt class="literal">gdb</tt>. The name of each system call, its
arguments, and its return value are printed to
<tt class="literal">STDERR</tt> or to the specified file.</p>

<p>The <a name="pmodperl-CHP-21-ITERM-5517" />tracing utility is a useful
diagnostic, instructional, and debugging tool. You can learn a lot
about the underlying system while examining traces of the running
programs. In the case of mod_perl, tracing improves performance by
enabling us to spot and eliminate redundant system calls. It also
useful in cases of problem debugging&#8212;for example, when some
process hangs.</p>

<p>Depending on your operating system, you should have available one of
the utilities <em class="emphasis">strace</em>,
<em class="emphasis">truss</em>, <em class="emphasis">tusc</em>,
<em class="emphasis">ktrace</em>, or similar. In this book we will use the
Linux <em class="emphasis">strace</em> utility.</p>

<p>There are two ways to get a trace of the process with
<a name="pmodperl-CHP-21-ITERM-5518" /><em class="emphasis">strace</em>. One way is
to tell <em class="emphasis">strace</em> to start the process and do the
tracing on it:</p>

<blockquote><pre class="code">panic% strace perl -le 'print "mod_perl rules"'</pre></blockquote>

<p>Another way is to tell <em class="emphasis">strace</em> to
attach<a name="pmodperl-CHP-21-ITERM-5519" /> to a process that's
already running:</p>

<blockquote><pre class="code">panic% strace -p PID</pre></blockquote>

<p>Replace <tt class="literal">PID</tt> with the process number you want to
check on.</p>

<p>Many other useful arguments are accepted by
<em class="emphasis">strace</em>. For example, you can tell it to trace
only specific system calls:</p>

<blockquote><pre class="code">panic% strace -e trace=open,write,close,nanosleep \
    perl -le 'print "mod_perl rules"'</pre></blockquote>

<p>In this example we have asked <em class="emphasis">strace</em> to show us
only the calls to <tt class="literal">open( ), write( )</tt>,
<tt class="literal">close( )</tt>, and <tt class="literal">nanosleep( )</tt>,
which reduces the output generated by <tt class="literal">strace</tt>,
making it simpler to understand&#8212;providing you know what you are
looking for.</p>

<p>The generated traces are too long (unless filtered with
<em class="emphasis">trace=tag</em>) to be presented here completely. For
example, if we ask for only the <tt class="literal">write( )</tt>system
calls, we get the following output:</p>

<blockquote><pre class="code">panic% strace -e trace=write perl -le 'print "mod_perl rules"'
write(1, "mod_perl rules\n", 15mod_perl rules
)  = 15</pre></blockquote>

<p>The output of the Perl one-liner gets mixed with the trace, so the
actual trace is:</p>

<blockquote><pre class="code">write(1, "mod_perl rules\n", 15)  = 15</pre></blockquote>

<p>Note that the newline was automatically appended because of the
<em class="emphasis">-l</em> option on the Perl command line.</p>

<p>Each line in the trace contains the system call name, followed by its
arguments in parentheses and its return value. In the last example, a
string of 15 characters was written to <tt class="literal">STDOUT</tt>,
whose file descriptor is 1. And we can see that they were all
successfully written, since the <tt class="literal">write( )</tt>system
call has returned a value of 15, the number of characters written.</p>

<p>The <em class="emphasis">strace</em> manpage provides a comprehensive
explanation of how to interpret all parts of the traces; you may want
to refer to this manpage to learn more about it.</p>



<hr width="684" align="left" />
<div class="navbar"><table width="684" border="0"><tr><td align="left" valign="top" width="228"><a href="ch21_02.html"><img src="../images//txtpreva.gif" alt="Previous" border="0" /></a></td><td align="center" valign="top" width="228"><a href="index.html"><img src="../images//txthome.gif" alt="Home" border="0" /></a></td><td align="right" valign="top" width="228"><a href="ch21_04.html"><img src="../images//txtnexta.gif" alt="Next" border="0" /></a></td></tr><tr><td align="left" valign="top" width="228">21.2. Debugging Code in Single-Server Mode</td><td align="center" valign="top" width="228"><a href="index/index.html"><img src="../images//index.gif" alt="Book Index" border="0" /></a></td><td align="right" valign="top" width="228">21.4. Tracing mod_perl-Specific Perl Calls</td></tr></table></div>
<hr width="684" align="left" />


<p><p><font size="-1"><a href="copyrght.html">Copyright &copy; 2003</a> O'Reilly &amp; Associates. All rights reserved.</font></p>

<map name="library-map">
<area shape="rect" coords="0,0,85,92" href="../index.html"><area shape="rect" coords="89,1,204,113" href="../apache/index.html"><area shape="rect" coords="208,-1,296,136" href="../php/index.html"><area shape="rect" coords="301,-1,403,132" href="../modperl/index.html"><area shape="rect" coords="406,3,503,115" href="../mysql/index.html"><area shape="rect" coords="507,2,596,142" href="../lian/index.html"><area shape="rect" coords="600,1,690,127" href="../rlinux/index.html">
</map>

</body></html>